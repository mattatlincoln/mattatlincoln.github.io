
<!DOCTYPE html>
<html>
  <head>

    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="chrome=1" />

    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

    <title>Hybrid functionals and ADMM slides</title>

    <script src="../../libs/require.min.js"></script>
    <script src="../../libs/jquery.min.js"></script>

    <!-- General and theme style sheets -->
    <link rel="stylesheet" href="../../revealjs//css/reveal.css">
    <link rel="stylesheet" href="../../revealjs//css/theme/simple.css" id="theme">

    <!-- If the query includes 'print-pdf', include the PDF print sheet -->
    <script>
      if( window.location.search.match( /print-pdf/gi ) ) {
      var link = document.createElement( 'link' );
      link.rel = 'stylesheet';
      link.type = 'text/css';
      link.href = '../../revealjs//css/print/pdf.css';
      document.getElementsByTagName( 'head' )[0].appendChild( link );
      }

    </script>

    <!--[if lt IE 9]>
	<script src="../../revealjs//lib/js/html5shiv.js"></script>
	<![endif]-->

    <!-- Loading the mathjax macro -->
    <!-- Load mathjax -->
    <!--script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS_HTML"></script-->
    <!-- MathJax configuration -->
	<script src="../../libs/MathJax-master/MathJax.js?config=TeX-AMS_HTML"></script>
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
      tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
      processEscapes: true,
      processEnvironments: true
      },
      // Center justify equations in code and markdown cells. Elsewhere
      // we use CSS to left justify single line equations in code cells.
      displayAlign: 'center',
      "HTML-CSS": {
      styles: {'.MathJax_Display': {"margin": 0}},
      linebreaks: { automatic: true }
      }
      });
    </script>
    <!-- End of mathjax configuration -->

    <!-- Get Font-awesome from cdn -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.1.0/css/font-awesome.css">

    <!-- Custom stylesheet, it must be in the same directory as the html file -->
    <link rel="stylesheet" href="../custom.css">

  </head>
  
  <body>

    <div class="reveal">
      <div class="slides">
	<section><section>
	    <div class="cell border-box-sizing text_cell rendered">
	      <div class="prompt input_prompt">
	      </div>
	      <div class="inner_cell" style='background:rgba(255,235,204,0.99)'>
		<div class="text_cell_render border-box-sizing rendered_html">
		  <h1 id="Hybrid-functionals-and-ADMM">Hybrid functionals and ADMM<a class="anchor-link" href="#Hybrid-functionals-and-ADMM">&#182;</a></h1><table cellspacing="0" cellpadding="0">
		    <tr>
		      <td><img src='../../images/MgO-Ag_island.png' width=400></td>
		      <td><img src='../../images/cp2k_logo_500.png' width=200></td>
		      <td><img src='../../images/lincoln_crest.png' width=200></td>
		    </tr>
		  </table><h2 id="Matt-Watkins">Matt Watkins<a class="anchor-link" href="#Matt-Watkins">&#182;</a></h2><h3 id="School-of-Mathematics-and-Physics,-University-of-Lincoln,-UK">School of Mathematics and Physics, University of Lincoln, UK<a class="anchor-link" href="#School-of-Mathematics-and-Physics,-University-of-Lincoln,-UK">&#182;</a></h3>
		</div>
	      </div>
	</div></section></section><section><section>
	    <div class="cell border-box-sizing text_cell rendered">
	      <div class="prompt input_prompt">
	      </div>
	      <div class="inner_cell" style='background:rgba(255,235,204,0.99)'>
		<div class="text_cell_render border-box-sizing rendered_html">
		  <h1 id="What-are-hybrid-functionals">What are hybrid functionals<a class="anchor-link" href="#What-are-hybrid-functionals">&#182;</a></h1><h3 id="Global-Hybrid-functions">Global Hybrid functions<a class="anchor-link" href="#Global-Hybrid-functions">&#182;</a></h3><p>mixing non-local Hartree-Fock exchange with semi-local DFT exchange</p>
		  $$
		  E_{XC} = \alpha E_X^{HFX}[\psi_i] + (1 - \alpha ) E_X^{DFT}[\rho] + E_C^{DFT}[\rho]
		  $$
		</div>
	      </div>
	</div></section></section><section><section>
	    <div class="cell border-box-sizing text_cell rendered">
	      <div class="prompt input_prompt">
	      </div>
	      <div class="inner_cell" style='background:rgba(255,235,204,0.99)'>
		<div class="text_cell_render border-box-sizing rendered_html">
		  <h1 id="Why-do-we-need-hybrids?">Why do we need hybrids?<a class="anchor-link" href="#Why-do-we-need-hybrids?">&#182;</a></h1><h2 id="Practical-motivations">Practical motivations<a class="anchor-link" href="#Practical-motivations">&#182;</a></h2><ul>
		    <li><p>Improved description of thermochemistry (e.g. atomizations energies, heats of formation)</p>
		    </li>
		    <li><p>Improved description of lattice constants, surface energies, ionization potentials and band gaps</p>
		    </li>
		    <li><p>Qualitatively correct description of localized and correlated states</p>
		    </li>
		  </ul>
		  <h2 id="Theoretical-motivations">Theoretical motivations<a class="anchor-link" href="#Theoretical-motivations">&#182;</a></h2><ul>
		    <li><p>Adiabatic connection</p>
		    </li>
		    <li><p>1-e energy level discontinuity</p>
		    </li>
		  </ul>

		</div>
	      </div>
	</div></section></section><section><section>
	    <div class="cell border-box-sizing text_cell rendered">
	      <div class="prompt input_prompt">
	      </div>
	      <div class="inner_cell" style='background:rgba(255,235,204,0.99)'>
		<div class="text_cell_render border-box-sizing rendered_html">
		  <h1 id="Why-do-we-need-hybrids?">Why do we need hybrids?<a class="anchor-link" href="#Why-do-we-need-hybrids?">&#182;</a></h1><table style="width:80%">
		    <tr>
		      <th>Functional</th>
		      <th>MAE (G2) / eV</th> 
		    </tr>
		    <tr>
		      <td>SVWN</td>
		      <td>5.2</td> 
		    </tr>
		    <tr>
		      <td>LSD (SVWN5)</td>
		      <td>3.6</td> 
		    </tr>
		    <tr>
		      <td>PBE </td>
		      <td>0.73</td> 
		    </tr>
		    <tr>
		      <td>BLYP</td>
		      <td>0.31</td> 
		    </tr>
		    <tr>
		      <td>B3LYP</td>
		      <td>0.13</td> 
		    </tr>
		    <tr>
		      <td>PBE0</td>
		      <td>0.21</td> 
		    </tr>
		  </table><p>Mean Absolute errors for atomization energies (eV)</p>
		  <p>Scuseria et al., J. Chem. Phys., 110, 5029 (1999)</p>

		</div>
	      </div>
	</div></section></section><section><section>
	    <div class="cell border-box-sizing text_cell rendered">
	      <div class="prompt input_prompt">
	      </div>
	      <div class="inner_cell" style='background:rgba(255,235,204,0.99)'>
		<div class="text_cell_render border-box-sizing rendered_html">
		  <h1 id="Why-do-we-need-hybrids?">Why do we need hybrids?<a class="anchor-link" href="#Why-do-we-need-hybrids?">&#182;</a></h1><table style="width:80%">
		    <tr>
		      <th>Statistic</th>
		      <th>LSDA</th> 
		      <th>PBE</th> 
		      <th>TPSS</th> 
		      <th>HSE</th> 
		    </tr>
		    <tr>
		      <td>ME</td>
		      <td>-1.14</td> 
		      <td>-1.13</td> 
		      <td>-0.98</td> 
		      <td>-0.17</td> 
		    </tr>
		    <tr>
		      <td>MAE</td>
		      <td>1.14</td> 
		      <td>1.13</td> 
		      <td>0.98</td> 
		      <td>0.17</td> 
		    </tr>
		    <tr>
		      <td>rms</td>
		      <td>1.24</td> 
		      <td>1.25</td> 
		      <td>1.12</td> 
		      <td>0.34</td> 
		    </tr>
		    <tr>
		      <td>Max (+)</td>
		      <td> - </td> 
		      <td> - </td> 
		      <td> - </td> 
		      <td>0.32</td> 
		    </tr>
		    <tr>
		      <td>Max (-)</td>
		      <td>-2.30</td> 
		      <td>-2.88</td> 
		      <td>-2.66</td> 
		      <td>-0.72</td> 
		    </tr>
		  </table><p>Mean Absolute errors for Band Gaps (eV)</p>
		  <p>Scuseria et al., J. Chem. Phys., 123, 174101 (2005)</p>

		</div>
	      </div>
	</div></section></section><section><section>
	    <div class="cell border-box-sizing text_cell rendered">
	      <div class="prompt input_prompt">
	      </div>
	      <div class="inner_cell" style='background:rgba(255,235,204,0.99)'>
		<div class="text_cell_render border-box-sizing rendered_html">
		  <h1 id="Hybrid-Functionals-with-CP2K">Hybrid Functionals with CP2K<a class="anchor-link" href="#Hybrid-Functionals-with-CP2K">&#182;</a></h1><ul>
		    <li>GGA: total energy functional of the electron density</li>
		  </ul>
		  $$
		  E[\rho] = T_S[\rho] + J[\rho] + E_{XC}[\rho] + \int v(\mathbf{r})\rho(\mathbf{r})\text{d}\mathbf{r}
		  $$<ul>
		    <li>hybrid: functional of density and two particle density matrix (orbitals) </li>
		  </ul>
		  $$
		  E_{XC} = \alpha E_X^{HFX}[\psi_i] + (1 - \alpha ) E_X^{DFT}[\rho] + E_C^{DFT}[\rho]
		  $$<p>Guidon, Hutter and VandeVondele, J. Chem. Theory Comput., 6, 2348 (2010)</p>

		</div>
	      </div>
	</div></section></section><section><section>
	    <div class="cell border-box-sizing text_cell rendered">
	      <div class="prompt input_prompt">
	      </div>
	      <div class="inner_cell" style='background:rgba(255,235,204,0.99)'>
		<div class="text_cell_render border-box-sizing rendered_html">
		  <h1 id="Hybrid-Functionals-with-CP2K">Hybrid Functionals with CP2K<a class="anchor-link" href="#Hybrid-Functionals-with-CP2K">&#182;</a></h1><ul>
		    <li>Hartree-Fock exchange energy</li>
		  </ul>
		  $$
		  E_X^{HFX} [P] = -\frac{1}{2} \sum_{\lambda \sigma \mu \nu} P^{\mu \sigma} P^{\nu \sigma} (\mu \nu | \lambda \sigma) 
		  $$$$
		  P^{\mu \nu} = \sum_i C^{\mu i} C^{\nu i} = CC^T
		  $$$$
		  (\mu \nu | \lambda \sigma) = \int \int 
		  \phi_{\mu}(\mathbf{r_1})\phi_{\nu}(\mathbf{r_1})
		  g\big(|\mathbf{r_1} - \mathbf{r_2}|\big)
		  \phi_{\lambda}(\mathbf{r_2})\phi_{\sigma}(\mathbf{r_2}) \text{d}\mathbf{r_1}\text{d}\mathbf{r_2}
		  $$<p>Four-centre two-electron integrals (ERIs) in Mulliken motation: naively $O(N^4)$ scaling</p>

		</div>
	      </div>
	</div></section></section><section><section>
	    <div class="cell border-box-sizing text_cell rendered">
	      <div class="prompt input_prompt">
	      </div>
	      <div class="inner_cell" style='background:rgba(255,235,204,0.99)'>
		<div class="text_cell_render border-box-sizing rendered_html">
		  <h1 id="Hybrid-Functionals-with-CP2K">Hybrid Functionals with CP2K<a class="anchor-link" href="#Hybrid-Functionals-with-CP2K">&#182;</a></h1><ul>
		    <li>permutation symmetry of the ERIs </li>
		  </ul>
		  $$
		  \begin{align}
		  (\mu \nu | \lambda \sigma) = (\nu \mu  | \lambda \sigma) = (\nu \mu | \sigma \lambda ) = (\mu \nu | \sigma \lambda ) \\
		  = (\lambda \sigma | \mu \nu ) = (\lambda \sigma | \nu \mu ) = (\sigma \lambda | \nu \mu  ) = (\sigma \lambda | \mu \nu  ) \\
		  \end{align}
		  $$<p>$O(N^4) \to \frac{1}{8}O(N^4)$</p>
		  <p>Guidon et al., J. Chem. Phys., 128, 214104 (2008)</p>

		</div>
	      </div>
	</div></section></section><section><section>
	    <div class="cell border-box-sizing text_cell rendered">
	      <div class="prompt input_prompt">
	      </div>
	      <div class="inner_cell" style='background:rgba(255,235,204,0.99)'>
		<div class="text_cell_render border-box-sizing rendered_html">
		  <h1 id="Hybrid-Functionals-with-CP2K">Hybrid Functionals with CP2K<a class="anchor-link" href="#Hybrid-Functionals-with-CP2K">&#182;</a></h1><ul>
		    <li>Integral screening: Schwarz inequality</li>
		  </ul>
		  $$
		  |(\mu \nu | \lambda \sigma)| \leq |(\mu \nu | \mu \nu)|^{1/2}|(\lambda \sigma) | \lambda \sigma)|^{1/2}
		  $$<p>$\frac{1}{8}O(N^4) \to O(N^2)$</p>
		  <p>Ahlrichs et al., J. Comput. Chem., 10, 104 (1989)</p>
		  <p>(see <a href="https://manual.cp2k.org/trunk/CP2K_INPUT/FORCE_EVAL/DFT/XC/HF/SCREENING.html#list_EPS_SCHWARZ">EPS_SCHWARZ</a> keyword in <a href="https://manual.cp2k.org/trunk/CP2K_INPUT/FORCE_EVAL/DFT/XC/HF/SCREENING.html">&amp;SCREENING</a> subsection)</p>
		  <p>Guidon et al., J. Chem. Phys., 128, 214104 (2008)</p>

		</div>
	      </div>
	</div></section></section><section><section>
	    <div class="cell border-box-sizing text_cell rendered">
	      <div class="prompt input_prompt">
	      </div>
	      <div class="inner_cell" style='background:rgba(255,235,204,0.99)'>
		<div class="text_cell_render border-box-sizing rendered_html">
		  <h1 id="Hybrid-Functionals-with-CP2K">Hybrid Functionals with CP2K<a class="anchor-link" href="#Hybrid-Functionals-with-CP2K">&#182;</a></h1><ul>
		    <li>Density matrix screening</li>
		  </ul>
		  $$
		  P_{\text{max}} \times |(\mu \nu | \mu \nu)|^{1/2}|(\lambda \sigma | \lambda \sigma)|^{1/2} \leq \epsilon_{\text{Schwarz}}
		  $$<p>where</p>
		  $$
		  P_{\text{max}} = \text{max}\{|P_{\mu \lambda}|, |P_{\mu \sigma}|, |P_{\nu \lambda}|, |P_{\nu \sigma}|\}
		  $$<p>finally linear scaling</p>
		  $$
		  O(N^2) \to O(N)
		  $$<p>(see <a href="SCREEN_ON_INITIAL_P">SCREEN_ON_INITIAL_P</a> keyword in <a href="https://manual.cp2k.org/trunk/CP2K_INPUT/FORCE_EVAL/DFT/XC/HF/SCREENING.html">&amp;SCREENING</a> subsection)</p>
		  <p>Guidon et al., J. Chem. Phys., 128, 214104 (2008)</p>
		  <p>$P_{max}$: largest density matrix element; usually, the density matrix from the previous SCF iteration is used for the screening in the next iteration, use pre-converged GGA density matrix; very useful for DFT molecular dynamics simulations using hybrid functionals</p>

		</div>
	      </div>
	</div></section></section><section><section>
	    <div class="cell border-box-sizing text_cell rendered">
	      <div class="prompt input_prompt">
	      </div>
	      <div class="inner_cell" style='background:rgba(255,235,204,0.99)'>
		<div class="text_cell_render border-box-sizing rendered_html">
		  <h1 id="Interaction-Potential">Interaction Potential<a class="anchor-link" href="#Interaction-Potential">&#182;</a></h1>$$
		  (\mu \nu | \lambda \sigma) = \int \int 
		  \phi_{\mu}(\mathbf{r_1})\phi_{\nu}(\mathbf{r_1})
		  g\big(|\mathbf{r_1} - \mathbf{r_2}|\big)
		  \phi_{\lambda}(\mathbf{r_2})\phi_{\sigma}(\mathbf{r_2}) \text{d}\mathbf{r_1}\text{d}\mathbf{r_2}
		  $$<ul>
		    <li>Standard Coulomb potential gives a global hybrid</li>
		  </ul>
		  $$
		  g(r) = \frac{1}{r}
		  $$<p>(see <a href="https://manual.cp2k.org/trunk/CP2K_INPUT/FORCE_EVAL/DFT/XC/HF/INTERACTION_POTENTIAL.html#POTENTIAL_TYPE">POTENTIAL_TYPE</a> keyword in <a href="https://manual.cp2k.org/trunk/CP2K_INPUT/FORCE_EVAL/DFT/XC/HF/INTERACTION_POTENTIAL.html">&amp;INTERACTION_POTENTIAL</a> subsection)</p>
		  <p>Guidon et al., J. Chem. Phys., 128, 214104 (2008)</p>
		  <p>For gas-phase, this energy is easy to evaluate; for periodic boundary conditions, it suffers from the integratable singularity, different approaches have been developed to obtain good convergence with respect to the $k$-point sum.</p>

		</div>
	      </div>
	</div></section></section><section><section>
	    <div class="cell border-box-sizing text_cell rendered">
	      <div class="prompt input_prompt">
	      </div>
	      <div class="inner_cell" style='background:rgba(255,235,204,0.99)'>
		<div class="text_cell_render border-box-sizing rendered_html">
		  <h1 id="Interaction-Potential">Interaction Potential<a class="anchor-link" href="#Interaction-Potential">&#182;</a></h1>$$
		  (\mu \nu | \lambda \sigma) = \int \int 
		  \phi_{\mu}(\mathbf{r_1})\phi_{\nu}(\mathbf{r_1})
		  g\big(|\mathbf{r_1} - \mathbf{r_2}|\big)
		  \phi_{\lambda}(\mathbf{r_2})\phi_{\sigma}(\mathbf{r_2}) \text{d}\mathbf{r_1}\text{d}\mathbf{r_2}
		  $$<ul>
		    <li>Range-separated Coulomb potential gives a range-separated hybrid</li>
		  </ul>
		  $$
		  g(r) = \frac{\text{erfc}(\omega r)}{r} + \frac{\text{erf}(\omega r)}{r}
		  $$<p>used in HSE06 etc.</p>
		  <p>(see <a href="https://manual.cp2k.org/trunk/CP2K_INPUT/FORCE_EVAL/DFT/XC/HF/INTERACTION_POTENTIAL.html#POTENTIAL_TYPE">POTENTIAL_TYPE</a> keyword in <a href="https://manual.cp2k.org/trunk/CP2K_INPUT/FORCE_EVAL/DFT/XC/HF/INTERACTION_POTENTIAL.html">&amp;INTERACTION_POTENTIAL</a> subsection)</p>
		  <p>Guidon et al., J. Chem. Phys., 128, 214104 (2008)</p>
		  <p>If omega is not large enough very large cells might be needed for HSE calculations at the $\Gamma$ point.</p>
		  <p>Costs are very different from plane-wave implementions - HSE is not typically cheaper than PBE0 - see next slide.</p>

		</div>
	      </div>
	</div></section></section><section><section>
	    <div class="cell border-box-sizing text_cell rendered">
	      <div class="prompt input_prompt">
	      </div>
	      <div class="inner_cell" style='background:rgba(255,235,204,0.99)'>
		<div class="text_cell_render border-box-sizing rendered_html">
		  <h1 id="Interaction-Potential">Interaction Potential<a class="anchor-link" href="#Interaction-Potential">&#182;</a></h1>$$
		  (\mu \nu | \lambda \sigma) = \int \int 
		  \phi_{\mu}(\mathbf{r_1})\phi_{\nu}(\mathbf{r_1})
		  g\big(|\mathbf{r_1} - \mathbf{r_2}|\big)
		  \phi_{\lambda}(\mathbf{r_2})\phi_{\sigma}(\mathbf{r_2}) \text{d}\mathbf{r_1}\text{d}\mathbf{r_2}
		  $$<ul>
		    <li>truncated Coulomb potential gives a global hybrid</li>
		  </ul>
		  $$
		  g(r_{12}) = 
		  \begin{cases}
		  \frac{1}{r_{12}} & \text{if } r_{12} \leq R_c \\
		  0 & \text{otherwise}
		  \end{cases}
		  $$<p>used in the snappily titles PBE0-TC family of functionals.</p>
		  <p>$R_C$ is specified by the <a href="https://manual.cp2k.org/trunk/CP2K_INPUT/FORCE_EVAL/DFT/XC/HF/INTERACTION_POTENTIAL.html#list_CUTOFF_RADIUS">CUTOFF_RADIUS</a> keyword.</p>
		  <p>(see <a href="https://manual.cp2k.org/trunk/CP2K_INPUT/FORCE_EVAL/DFT/XC/HF/INTERACTION_POTENTIAL.html#POTENTIAL_TYPE">POTENTIAL_TYPE</a> keyword in <a href="https://manual.cp2k.org/trunk/CP2K_INPUT/FORCE_EVAL/DFT/XC/HF/INTERACTION_POTENTIAL.html">&amp;INTERACTION_POTENTIAL</a> subsection)</p>
		  <p>Guidon et al., J. Chem. Phys., 128, 214104 (2008)</p>
		  <p>Truncation is mainly for solid-state environments and avoids numerical problems with $\Gamma$ point global hybrid calculations.</p>
		  <p>$R_C$ must be smaller than half the smallest cell dimension.</p>
		  <p>Requires a <code>T_C_G_DATA</code> file - by default in <code>/cp2k/data</code> and a modern installation should just find it.</p>

		</div>
	      </div>
	</div></section></section><section><section>
	    <div class="cell border-box-sizing text_cell rendered">
	      <div class="prompt input_prompt">
	      </div>
	      <div class="inner_cell" style='background:rgba(255,235,204,0.99)'>
		<div class="text_cell_render border-box-sizing rendered_html">
		  <h1 id="Interaction-Potential">Interaction Potential<a class="anchor-link" href="#Interaction-Potential">&#182;</a></h1>$$
		  (\mu \nu | \lambda \sigma) = \int \int 
		  \phi_{\mu}(\mathbf{r_1})\phi_{\nu}(\mathbf{r_1})
		  g\big(|\mathbf{r_1} - \mathbf{r_2}|\big)
		  \phi_{\lambda}(\mathbf{r_2})\phi_{\sigma}(\mathbf{r_2}) \text{d}\mathbf{r_1}\text{d}\mathbf{r_2}
		  $$<ul>
		    <li>truncated Coulomb potential gives a global hybrid</li>
		  </ul>
		  $$
		  g(r_{12}) = 
		  \begin{cases}
		  \frac{1}{r_{12}} & \text{if } r_{12} \leq R_c \\
		  0 & \text{otherwise}
		  \end{cases}
		  $$<p>We can add in a long range correction, to replace the exchange energy lost by truncation.</p>
		  <p>See the <a href="https://manual.cp2k.org/trunk/CP2K_INPUT/FORCE_EVAL/DFT/XC/XC_FUNCTIONAL/PBE_HOLE_T_C_LR.html">&amp;PBE_HOLE_T_C_LR</a> subsection in the <a href="https://manual.cp2k.org/trunk/CP2K_INPUT/FORCE_EVAL/DFT/XC/XC_FUNCTIONAL.html">&amp;XC_FUNCTIONAL</a> section.</p>
		  <p>This gives the even more snappily titled PBE0-TC-LRC family of functionals.</p>
		  <p>Guidon et al., J. Chem. Theory Comput., 5, 3010 (2008)</p>

		</div>
	      </div>
	</div></section></section><section><section>
	    <div class="cell border-box-sizing text_cell rendered">
	      <div class="prompt input_prompt">
	      </div>
	      <div class="inner_cell" style='background:rgba(255,235,204,0.99)'>
		<div class="text_cell_render border-box-sizing rendered_html">
		  <h1 id="Auxiliary-Density-Matrix-Methods-(ADMM)">Auxiliary Density Matrix Methods (ADMM)<a class="anchor-link" href="#Auxiliary-Density-Matrix-Methods-(ADMM)">&#182;</a></h1>$$
		  E[\rho] = T_S[\rho] + J[\rho] + E_{XC}[\rho, P] + \int v(\mathbf{r})\rho(\mathbf{r})\text{d}\mathbf{r}
		  $$$$
		  E_{XC} = \alpha E_X^{HFX}[P] + (1 - \alpha ) E_X^{DFT}[\rho] + E_C^{DFT}[\rho]
		  $$$$
		  E_X^{HFX} [P] = -\frac{1}{2} \sum_{\lambda \sigma \mu \nu} P^{\mu \sigma} P^{\nu \sigma} (\mu \nu | \lambda \sigma) 
		  $$<p>introduce auxiliary density matrix $\hat{P}\approx P$</p>
		  \begin{align}
		  E_X^{HFX} [P] & = E_X^{HFX}[\hat{P}] + E_X^{HFX}[P] - E_X^{HFX}[\hat{P}]\\
		  & \approx E_X^{HFX}[\hat{P}] + E_X^{DFT}[P] - E_X^{DFT}[\hat{P}]
		  \end{align}<p>Guidon, Hutter and VandeVondele, J. Chem. Theory Comput., 6, 2348 (2010)</p>

		</div>
	      </div>
	</div></section></section><section><section>
	    <div class="cell border-box-sizing text_cell rendered">
	      <div class="prompt input_prompt">
	      </div>
	      <div class="inner_cell" style='background:rgba(255,235,204,0.99)'>
		<div class="text_cell_render border-box-sizing rendered_html">
		  <h1 id="Auxiliary-Density-Matrix-Methods-(ADMM)">Auxiliary Density Matrix Methods (ADMM)<a class="anchor-link" href="#Auxiliary-Density-Matrix-Methods-(ADMM)">&#182;</a></h1><ul>
		    <li>total energy functional of both $P$ and $\hat{P}$</li>
		  </ul>
		  $$
		  E_{total} = E[P] + \hat{E}[\hat{P}]
		  $$<ul>
		    <li>still Kohn-Sham theory with ADMM</li>
		  </ul>
		  \begin{align}
		  K_{total} & = \frac{\partial E[P]}{ \partial P} + \frac{\partial \hat{E}[\hat{P}]}{ \partial P} \\
		  & = K + \frac{\partial \hat{E}[\hat{P}]}{ \partial \hat{P}}\frac{\partial \hat{P}}{ \partial P}
		  \end{align}<p>using a chain rule and</p>
		  $$
		  K_{total} C = SC\epsilon
		  $$<p>as the equation to be solved self-consistently. (Simplest case given here, ADMM1)</p>
		  <p>Guidon, Hutter and VandeVondele, J. Chem. Theory Comput., 6, 2348 (2010)</p>

		</div>
	      </div>
	</div></section></section><section><section>
	    <div class="cell border-box-sizing text_cell rendered">
	      <div class="prompt input_prompt">
	      </div>
	      <div class="inner_cell" style='background:rgba(255,235,204,0.99)'>
		<div class="text_cell_render border-box-sizing rendered_html">
		  <h1 id="Auxiliary-Density-Matrix-Methods-(ADMM)">Auxiliary Density Matrix Methods (ADMM)<a class="anchor-link" href="#Auxiliary-Density-Matrix-Methods-(ADMM)">&#182;</a></h1><ul>
		    <li>Construction of auxiliary density matrix</li>
		  </ul>
		  $$
		  \hat{\psi}_i (\mathbf{r}) = \sum_\mu \hat{C}^{\mu i}\hat{\phi}_\mu (\mathbf{r})
		  $$$$
		  \hat{P}^{\mu \nu} = \sum_i \hat{C}^{\mu i} \hat{C}^{\nu i} = \hat{C}\hat{C}^T
		  $$<ul>
		    <li>we find the $\hat{C}$ that minimises the difference between occupied wavefunctions in the primary and secondary basis sets:</li>
		  </ul>
		  $$
		  \sum_i \int \big(\psi_j(\mathbf{r}) - \hat{\psi}_j(\mathbf{r})\big)^2 \text{d}\mathbf{r}
		  $$<p>(see ADMM_PURIFICATION_METHOD=NONE keyword in &amp;AUXILIARY_DENSITY_MATRIX_METHOD subsection)</p>
		  <p>Guidon, Hutter and VandeVondele, J. Chem. Theory Comput., 6, 2348 (2010)</p>

		</div>
	      </div>
	</div></section></section><section><section>
	    <div class="cell border-box-sizing text_cell rendered">
	      <div class="prompt input_prompt">
	      </div>
	      <div class="inner_cell" style='background:rgba(255,235,204,0.99)'>
		<div class="text_cell_render border-box-sizing rendered_html">
		  <h1 id="Auxiliary-Density-Matrix-Methods-(ADMM)">Auxiliary Density Matrix Methods (ADMM)<a class="anchor-link" href="#Auxiliary-Density-Matrix-Methods-(ADMM)">&#182;</a></h1><ul>
		    <li>Construction of auxiliary density matrix enforcing indempotent auxiliary density matrix</li>
		  </ul>
		  $$
		  \hat{\psi}_i (\mathbf{r}) = \sum_\mu \hat{C}^{\mu i}\hat{\phi}_\mu (\mathbf{r})
		  $$$$
		  \hat{P}^{\mu \nu} = \sum_i \hat{C}^{\mu i} \hat{C}^{\nu i} = \hat{C}\hat{C}^T
		  $$<ul>
		    <li>we find the $\hat{C}$ that minimises the difference between occupied wavefunctions in the primary and secondary basis sets subject to the constraint that the auxiliary wavefunctions are orthonormal:</li>
		  </ul>
		  $$
		  \sum_i \int  \big(\psi_j(\mathbf{r}) - \hat{\psi}_j(\mathbf{r})\big)^2 \text{d}\mathbf{r} +
		  \sum_{k,l} \Lambda_{kl} \big( \int \hat{\psi}_k(\mathbf{r}) \hat{\psi}_l(\mathbf{r}) \text{d}\mathbf{r} - \delta_{kl}\big)
		  $$<p>The $\Lambda$ matrix contains the Lagrangian multipliers enforcing orthonormality.</p>
		  <p>(see ADMM_PURIFICATION_METHOD=MO_DIAG keyword in &amp;AUXILIARY_DENSITY_MATRIX_METHOD subsection)</p>
		  <p>Guidon, Hutter and VandeVondele, J. Chem. Theory Comput., 6, 2348 (2010)</p>

		</div>
	      </div>
	</div></section></section><section><section>
	    <div class="cell border-box-sizing text_cell rendered">
	      <div class="prompt input_prompt">
	      </div>
	      <div class="inner_cell" style='background:rgba(255,235,204,0.99)'>
		<div class="text_cell_render border-box-sizing rendered_html">
		  <h1 id="Auxiliary-Density-Matrix-Methods-(ADMM)">Auxiliary Density Matrix Methods (ADMM)<a class="anchor-link" href="#Auxiliary-Density-Matrix-Methods-(ADMM)">&#182;</a></h1><ul>
		    <li>Construction of auxiliary density matrix constraint on total charge</li>
		  </ul>
		  $$
		  W_Q = \sum_i^{\text{occ}} \left< (i-\tilde{i})^2 \right> + \lambda \Bigg(\frac{N}{2} - \sum_i^{\text{occ}} \left< \tilde{i^2} \right> \Bigg)
		      $$<p>(see EXCH_SCALING_MODEL keyword in &amp;AUXILIARY_DENSITY_MATRIX_METHOD subsection)</p>
		      <p>Merlot et al., J. Chem. Phys., 141, 094101 (2014)</p>

		</div>
	      </div>
	</div></section></section><section><section>
	    <div class="cell border-box-sizing text_cell rendered">
	      <div class="prompt input_prompt">
	      </div>
	      <div class="inner_cell" style='background:rgba(255,235,204,0.99)'>
		<div class="text_cell_render border-box-sizing rendered_html">
		  <h1 id="ADMM-forces">ADMM forces<a class="anchor-link" href="#ADMM-forces">&#182;</a></h1>$$
		  \frac{dE}{d \mathbf{R}} = \frac{dE[P]}{d \mathbf{R}} + \frac{d\hat{E}[\hat{P}]}{d \mathbf{R}}
		  $$<p>where $\hat{P}$ is defined via $\hat{C} = AC$. Then various chain rules ...</p>
		  $$
		  \frac{d\hat{E}[\hat{P}]}{d \mathbf{R}} +  \frac{d\hat{E}[\hat{P}]}{d \hat{C}}\frac{\hat{C}}{d \mathbf{R}} = \hat{U} \frac{\hat{C}}{d \mathbf{R}}
		  $$$$
		  \hat{U} = \frac{d\hat{E}[\hat{P}]}{d \hat{C}} = \frac{d\hat{E}[\hat{P}]}{d \hat{P}}\frac{d\hat{P}}{d \hat{C}} = \hat{K} \hat{C}
		  $$<p>finally</p>
		  $$
		  \frac{d\hat{E}[\hat{P}]}{d \mathbf{R}} = \hat{U}_{ab}\Big[ \frac{dA}{d \mathbf{R}} C \Lambda^{-1/2} \Big]_{ab} + \hat{U}_{ab} \Big[ AC \frac{d \Lambda^{-1/2}}{d \mathbf{R}}
		  \Big]_{ab}
		  $$<p>Forces for MO_Diag and non-purified ADMM implemented. Linear algebra can get expensive for larger systems (reason for contracted auxiliary basis sets)</p>

		</div>
	      </div>
	</div></section></section><section><section>
	    <div class="cell border-box-sizing text_cell rendered">
	      <div class="prompt input_prompt">
	      </div>
	      <div class="inner_cell" style='background:rgba(255,235,204,0.99)'>
		<div class="text_cell_render border-box-sizing rendered_html">
		  <h1 id="Auxiliary-Density-Matrix-Methods-(ADMM)">Auxiliary Density Matrix Methods (ADMM)<a class="anchor-link" href="#Auxiliary-Density-Matrix-Methods-(ADMM)">&#182;</a></h1><ul>
		    <li>several GGA exchange corrections using different functionals</li>
		  </ul>
		  \begin{align}
		  E_X^{HFX} [P] & = E_X^{HFX}[\hat{P}] + E_X^{HFX}[P] - E_X^{HFX}[\hat{P}]\\
		  & \approx E_X^{HFX}[\hat{P}] + E_X^{DFT}[P] - E_X^{DFT}[\hat{P}]
		  \end{align}<p>DFT can be B88, PBE, OPTX, KT3X</p>
		  <p>(see EXCH_CORRECTION_FUNC keyword in &amp;AUXILIARY_DENSITY_MATRIX_METHOD subsection)</p>

		</div>
	      </div>
	</div></section></section><section><section>
	    <div class="cell border-box-sizing text_cell rendered">
	      <div class="prompt input_prompt">
	      </div>
	      <div class="inner_cell" style='background:rgba(255,235,204,0.99)'>
		<div class="text_cell_render border-box-sizing rendered_html">
		  <h1 id="ADMM-basis-sets">ADMM basis sets<a class="anchor-link" href="#ADMM-basis-sets">&#182;</a></h1><p>Initially available from H to Cl optimized against atomic calculations</p>
		  <p>Choice of auxiliary basis set for ADMM</p>
		  <ul>
		    <li>FIT3: three Gaussian exponents for each valence orbital</li>
		    <li>cFIT3: a contraction of FIT3</li>
		    <li>pFIT3: FIT3 + polarization functions</li>
		    <li>cpFIT3: cFIT3 + polarization functions</li>
		    <li>aug-FIT3, aug-cFIT3, aug-pFIT3, aug-cpFIT3: augmented with a “diffuse” function</li>
		  </ul>
		  <p>(see $CP2K/cp2k/data/BASIS_ADMM)</p>
		  <p>Guidon, Hutter and VandeVondele, J. Chem. Theory Comput., 6, 2348 (2010)</p>

		</div>
	      </div>
	</div></section></section><section><section>
	    <div class="cell border-box-sizing text_cell rendered">
	      <div class="prompt input_prompt">
	      </div>
	      <div class="inner_cell" style='background:rgba(255,235,204,0.99)'>
		<div class="text_cell_render border-box-sizing rendered_html">
		  <h1 id="ADMM-basis-sets">ADMM basis sets<a class="anchor-link" href="#ADMM-basis-sets">&#182;</a></h1><p>Uncontracted basis sets for transition metals:</p>
		  <ul>
		    <li>FIT10: 4s + 3p + 3d</li>
		    <li>FIT11: 4s + 3p + 3d + 1f</li>
		    <li>FIT12: 4s + 3p + 4d + 1f</li>
		    <li>FIT13: 4s + 4p + 4d + 1f</li>
		  </ul>
		  <p>Contracted basis sets (double-$\zeta$ quality)</p>
		  <ul>
		    <li>cFIT10 / cFIT11 / cFIT12 / cFIT13</li>
		  </ul>
		  <p>Names of the ADMM basis sets for main group elements will differ slightly, and usually the first ADMM basis set will not contain polarisation function.</p>
		  <p>(see $CP2K/cp2k/data/BASIS_ADMM_MOLOPT)</p>
		  <p>Ling &amp; Slater, unpublished</p>

		</div>
	      </div>
	</div></section></section><section><section>
	    <div class="cell border-box-sizing text_cell rendered">
	      <div class="prompt input_prompt">
	      </div>
	      <div class="inner_cell" style='background:rgba(255,235,204,0.99)'>
		<div class="text_cell_render border-box-sizing rendered_html">
		  <h1 id="General-remarks">General remarks<a class="anchor-link" href="#General-remarks">&#182;</a></h1><ul>
		    <li>Always check the convergence of CUTOFF</li>
		    <li>Always check the convergence of properties (e.g. lattice parameters, band gaps) with respect to supercell sizes</li>
		    <li>Always start from pre-converged GGA (e.g. PBE) wavefunction and geometry</li>
		    <li>Always check the convergence of primary and ADMM basis sets <ul>
			<li>start from a small basis and gradually increase the size</li>
		      </ul>
		    </li>
		    <li>ADMM has only been implemented for use with GPW</li>
		    <li>Only ADMM1 will work with some other functionality (smearing, TDDFPT)</li>
		  </ul>

		</div>
	      </div>
	</div></section></section><section><section>
	    <div class="cell border-box-sizing text_cell rendered">
	      <div class="prompt input_prompt">
	      </div>
	      <div class="inner_cell" style='background:rgba(255,235,204,0.99)'>
		<div class="text_cell_render border-box-sizing rendered_html">
		  <h1 id="Example:-Diamond-band-gap">Example: Diamond band-gap<a class="anchor-link" href="#Example:-Diamond-band-gap">&#182;</a></h1><table style="width:100%">
		    <tr>
		      <th>method</th>
		      <th>number of integrals</th> 
		      <th>gap [eV]</th> 
		    </tr>
		    <tr>
		      <td>PBE (PBS)</td>
		      <td> </td> 
		      <td>4.17</td> 
		    </tr>
		    <tr>
		      <td>PBE (ABS)</td>
		      <td> </td> 
		      <td>4.37</td> 
		    </tr>
		    <tr>
		      <td>PBE0 (PBS)</td>
		      <td>40, 787, 850, 778, 591 </td> 
		      <td>6.07</td> 
		    </tr>
		    <tr>
		      <td>PBE0 (ABS)</td>
		      <td> 23, 561, 509, 497</td> 
		      <td>6.25</td> 
		    </tr>
		    <tr>
		      <td>PBE0 ADMM1</td>
		      <td>24, 816, 897, 009 </td> 
		      <td>6.03</td> 
		    </tr>
		    <tr>
		      <td>PBE0 ADMM2</td>
		      <td> 24, 795, 460, 638</td> 
		      <td>6.02</td> 
		    </tr>
		  </table><p>Guidon, Hutter and VandeVondele, J. Chem. Theory Comput., 6, 2348 (2010)</p>

		</div>
	      </div>
	</div></section></section><section><section>
	    <div class="cell border-box-sizing text_cell rendered">
	      <div class="prompt input_prompt">
	      </div>
	      <div class="inner_cell" style='background:rgba(255,235,204,0.99)'>
		<div class="text_cell_render border-box-sizing rendered_html">
		  <h1 id="Example:-Silicon-band-gap">Example: Silicon band-gap<a class="anchor-link" href="#Example:-Silicon-band-gap">&#182;</a></h1><table style="width:100%">
		    <tr>
		      <th>Cutoff Radius [nm]</th>
		      <th>Band gap [eV]</th> 
		      <th># Integrals</th> 
		    </tr>
		    <tr>
		      <td>0.2 </td>
		      <td>1.16 $^a$</td> 
		      <td>77799946176 $^a$</td> 
		    </tr>
		    <tr>
		      <td>0.4 </td>
		      <td>1.54 $^a$</td> 
		      <td>154325979000 $^a$</td> 
		    </tr>
		    <tr>
		      <td>0.6 </td>
		      <td>1.71 $^a$</td> 
		      <td>265868148312 $^a$</td> 
		    </tr>
		    <tr>
		      <td>0.8 </td>
		      <td>1.78 $^a$</td> 
		      <td>422457823080 $^a$</td> 
		    </tr>
		  </table><p>PBE0-TC-LRC with cFIT3 ADMM basis, 3x3x3 supercell, 216 atoms</p>
		  <table style="width:100%">
		    <tr>
		      <th>ADMM basis</th>
		      <th>Band gap [eV]</th> 
		      <th># Integrals</th> 
		    </tr>
		    <tr>
		      <td>cFIT3 </td>
		      <td>1.16 $^a$ </td> 
		      <td>422457823080 $^a$</td> 
		    </tr>
		    <tr>
		      <td>FIT3 </td>
		      <td>1.80 $^a$ </td> 
		      <td>424426850352 $^a$</td> 
		    </tr>
		    <tr>
		      <td>pFIT3 </td>
		      <td>1.98 $^a$ </td> 
		      <td>1447428361680 $^a$</td> 
		    </tr>
		    <tr>
		      <td>Ref. (VASP) </td>
		      <td>1.93 $^b$</td> 
		      <td></td> 
		    </tr>
		  </table><p>PBE0-TC-LRC with 8 Å cutoff radius, 3x3x3 supercell, 216 atoms</p>
		  <p>$^a$ Ling &amp; Slater, unpublished; $^b$ Paier et al., J. Chem. Phys. 124, 154709 (2006)</p>

		</div>
	      </div>
	</div></section></section><section><section>
	    <div class="cell border-box-sizing text_cell rendered">
	      <div class="prompt input_prompt">
	      </div>
	      <div class="inner_cell" style='background:rgba(255,235,204,0.99)'>
		<div class="text_cell_render border-box-sizing rendered_html">
		  <h1 id="Functionals">Functionals<a class="anchor-link" href="#Functionals">&#182;</a></h1><ul>
		    <li>PBE0-TC-LRC, Long Range Corrected truncated global hybrid</li>
		  </ul>
		  $$
		  E_{XC}^{PBE0-TC-LRC} = aE_{X}^{HF,TC}(R_c) + aE_{X}^{PBE,LRC}(R_c) + (1-a)E_{X}^{PBE} + E_C^{PBE}
		  $$<p>Guidon et al., J. Chem. Theory Comput., 5, 3010 (2008)
		    Spencer &amp; Alavi, Phys. Rev. B, 77, 193110 (2008)</p>
		  <ul>
		    <li>HSE, Range separated hybrid</li>
		  </ul>
		  $$
		  E_{XC}^{HSE} = aE_{X}^{HF,SR}(\omega)+ (1-a)E_{X}^{PBE,SR}(\omega) + E_{X}^{PBE,LR}(\omega) + E_C^{PBE}
		  $$<p>Scuceria et al., J. Chem. Phys., 125, 224106 (2006)</p>
		  <p>"Empirical" parameters: $a, R_c,$ and $\omega$</p>
		  <p>(note the 0 in PBE0 stands for 0 empirical parameters...)</p>

		</div>
	      </div>
	</div></section></section><section><section>
	    <div class="cell border-box-sizing text_cell rendered">
	      <div class="prompt input_prompt">
	      </div>
	      <div class="inner_cell" style='background:rgba(255,235,204,0.99)'>
		<div class="text_cell_render border-box-sizing rendered_html">
		  <h1 id="Input-structure">Input structure<a class="anchor-link" href="#Input-structure">&#182;</a></h1>
		  <p>Sketch of the key sections for running an ADMM calculation
		    <pre>
		    <code>
		      &DFT
		        …
		        BASIS_SET_FILE_NAME ./BASIS_MOLOPT
		        BASIS_SET_FILE_NAME ./BASIS_ADMM
		        WFN_RESTART_FILE_NAME ${project}-RESTART.wfn
		        ...
		        &SCF
		          ...
		          SCF_GUESS RESTART
		          ...
		        &END SCF
		        &AUXILIARY_DENSITY_MATRIX_METHOD
		          METHOD BASIS_PROJECTION
		          ADMM_PURIFICATION_METHOD MO_DIAG
		        &END AUXILIARY_DENSITY_MATRIX_METHOD
		        ...
		        &XC
		        ...
		        &END XC
		      &END DFT
		      &SUBSYS
		        &KIND Si
		          BASIS_SET DZVP-MOLOPT-SR-GTH
		          AUX_FIT_BASIS_SET FIT3
		          POTENTIAL GTH-PBE-q4
		        &END KIND
		      &END SUBSYS
		  </code></pre></p>

		</div>
	      </div>
	</div></section></section>
	<section><section>
	    <div class="cell border-box-sizing text_cell rendered">
	      <div class="prompt input_prompt">
	      </div>
	      <div class="inner_cell" style='background:rgba(255,235,204,0.99)'>
		<div class="text_cell_render border-box-sizing rendered_html">
		  <style>
		    * {
		    box-sizing: border-box;
		    }
		    .column {
		    float: left;
		    padding: 20px;
		    font-size: small;
		    }
		    .clearfix::after {
		    content: "";
		    clear: both;
		    display: table;
		    }
		    .content {
		    width: 450px;
		    }
		  </style>
		  <h1 id="PBE0-vs-HSE">PBE0 vs HSE<a class="anchor-link" href="#PBE0-vs-HSE">&#182;</a></h1>
		  <p>Input structure</p>
		  <div class="row">
		    <div class="column clearfix content">
		      <pre>
			<code>
&XC
  &XC_FUNCTIONAL
    &PBE
      SCALE_X 0.75
      SCALE_C 1.0
    &END PBE
    &PBE_HOLE_T_C_LR
      CUTOFF_RADIUS 2.0
      SCALE_X 0.25
    &END PBE_HOLE_T_C_LR
  &END XC_FUNCTIONAL
  &HF
    &SCREENING
      EPS_SCHWARZ 1.0E-6
      SCREEN_ON_INITIAL_P FALSE
    &END SCREENING
    &INTERACTION_POTENTIAL
      POTENTIAL_TYPE TRUNCATED
      CUTOFF_RADIUS 2.0
      T_C_G_DATA ./t_c_g.dat
    &END INTERACTION_POTENTIAL
    &MEMORY
      MAX_MEMORY 2400
      EPS_STORAGE_SCALING 0.1
    &END MEMORY
    FRACTION 0.25
  &END HF
&END XC
			</code>
		      </pre>  
		    </div>
		    <div class="column clearfix content">
		      <pre>
			<code>
&XC
  &XC_FUNCTIONAL
    &PBE
      SCALE_X 0.0
      SCALE_C 1.0
    &END PBE
    &XWPBE
      SCALE_X -0.25
      SCALE_X0 1.0
      OMEGA 0.11
    &END XWPBE
  &END XC_FUNCTIONAL
  &HF
    &SCREENING
      EPS_SCHWARZ 1.0E-6
      SCREEN_ON_INITIAL_P FALSE
    &END SCREENING
    &INTERACTION_POTENTIAL
      POTENTIAL_TYPE SHORTRANGE
      OMEGA 0.11
    &END INTERACTION_POTENTIAL
    &MEMORY
      MAX_MEMORY  2400
      EPS_STORAGE_SCALING 0.1
    &END MEMORY
    FRACTION 0.25
  &END HF
&END XC
			</code>
		      </pre>
		    </div>
		  </div>
		  
		  <p>(see examples in $CP2K/cp2k/tests/QS/regtest-admm-1/2/3/4)</p>		    

		</div>
	      </div>
</section></section><section><section>
    <div class="cell border-box-sizing text_cell rendered">
      <div class="prompt input_prompt">
      </div>
      <div class="inner_cell" style='background:rgba(255,235,204,0.99)'>
	<div class="text_cell_render border-box-sizing rendered_html">
	  <h1 id="Output">Output<a class="anchor-link" href="#Output">&#182;</a></h1>

	  <pre><code>  Step     Update method      Time    Convergence         Total energy    Change

	      HFX_MEM_INFO| Est. max. program size before HFX [MiB]:                     563

	      *** WARNING in hfx_energy_potential.F:600 :: The Kohn Sham matrix is not  ***
	      *** 100% occupied. This may result in incorrect Hartree-Fock results. Try ***
	      *** to decrease EPS_PGF_ORB and EPS_FILTER_MATRIX in the QS section. For  ***
	      *** more information see FAQ: https://www.cp2k.org/faq:hfx_eps_warning    ***

	      HFX_MEM_INFO| Number of cart. primitive ERI's calculated:         218851035670
	      HFX_MEM_INFO| Number of sph. ERI's calculated:                    152193561473
	      HFX_MEM_INFO| Number of sph. ERI's stored in-core:                 22711518963
	      HFX_MEM_INFO| Number of sph. ERI's stored on disk:                           0
	      HFX_MEM_INFO| Number of sph. ERI's calculated on the fly:                    0
	      HFX_MEM_INFO| Total memory consumption ERI's RAM [MiB]:                  21290
	      HFX_MEM_INFO| Whereof max-vals [MiB]:                                     1516
	      HFX_MEM_INFO| Total compression factor ERI's RAM:                         8.14
	      HFX_MEM_INFO| Total memory consumption ERI's disk [MiB]:                     0
	      HFX_MEM_INFO| Total compression factor ERI's disk:                        0.00
	      HFX_MEM_INFO| Size of density/Fock matrix [MiB]:                           764
	      HFX_MEM_INFO| Size of buffers [MiB]:                                       118
	      HFX_MEM_INFO| Number of periodic image cells considered:                     7
	      HFX_MEM_INFO| Est. max. program size after HFX  [MiB]:                    1549

	      1 OT DIIS     0.80E-01   82.1     0.00000107    -17361.4683416734 -1.74E+04
	      2 OT DIIS     0.80E-01   43.3     0.00000085    -17361.4683473031 -5.63E-06</code></pre>
	  <p>
	    <code>Number of sph. ERI's calculated on the fly:</code> should ideally be zero.</p>
	  <p>We want to keep ERIs in memory during the SCF loop.
	  </p>

	</div>
      </div>
</div></section></section><section><section>
    <div class="cell border-box-sizing text_cell rendered">
      <div class="prompt input_prompt">
      </div>
      <div class="inner_cell" style='background:rgba(255,235,204,0.99)'>
	<div class="text_cell_render border-box-sizing rendered_html">
	  <h1 id="Extra-remarks">Extra remarks<a class="anchor-link" href="#Extra-remarks">&#182;</a></h1><ul>
	    <li><p>Libint library is used to calculate ERIs and their analytic derivatives, see $CP2K/cp2k/INSTALL for more details on installation and linking with CP2K</p>
	    </li>
	    <li><p>Hybrid DFT calculations of large systems are memory demanding, try to increase MAX_MEMORY or run the job with more MPI processes. Note MAX_MEMORY is the memory per MPI process for ERIs, you must leave space for operating system and rest of the CP2K calculation.</p>
	    </li>
	    <li><p>For extremely large hybrid DFT calculations, try hybrid MPI/OpenMP binary (i.e. cp2k.psmp)</p>
	    </li>
	  </ul>

	</div>
      </div>
</div></section></section><section><section>
    <div class="cell border-box-sizing text_cell rendered">
      <div class="prompt input_prompt">
      </div>
      <div class="inner_cell" style='background:rgba(255,235,204,0.99)'>
	<div class="text_cell_render border-box-sizing rendered_html">
	  <h1 id="Examples">Examples<a class="anchor-link" href="#Examples">&#182;</a></h1><p>TiO$_2$ is everyone's favourite material - hybrid calculations with ~1000 atoms and good basis sets using CP2K</p>
	  <table cellspacing="0" cellpadding="0">
	    <tr>
	      <td><img src='../../images/prl_fig3.png' width=300></td>
	      <td><img src='images/struc_multimers.png' width=300></td>
	    </tr>
	    <tr>
	      <td><img src='../../images/prl_fig4.png' width=300></td>
	      <td><img src='images/STM_multimers.png' width=300></td>
	    </tr>
	  </table><p>Yim et al, Phys. Rev. Lett. 117, 116402 (2016)</p>

	</div>
      </div>
</div></section></section><section><section>
    <div class="cell border-box-sizing text_cell rendered">
      <div class="prompt input_prompt">
      </div>
      <div class="inner_cell" style='background:rgba(255,235,204,0.99)'>
	<div class="text_cell_render border-box-sizing rendered_html">
	  <h1 id="Fun-and-games">Fun and games<a class="anchor-link" href="#Fun-and-games">&#182;</a></h1><p>ADMM is not just an approximation to full hybrid DFT, but can be used in other ways</p>
	  <ul>
	    <li>embedding: smaller basis sets / no basis sets on some atoms</li>
	  </ul>
	  <table cellspacing="0" cellpadding="0">
	    <tr><td><img src='../../images/MgO-Ag_island.png' width=350>
	      </td><td><img src='images/admm_metals.png' width=250></td>
</td><td><img src='images/MgO-Ag_bandgap.png' width=350></td>
</tr>
</table><p>Ling et al. "Effects of oxide roughness at metal oxide interface: MgO on Ag (001)."  J.  Phys. Chem. C 117.10 (2013): 5075-5083.</p>
<ul>
  <li>flexible +U: only have ADMM basis sets of certain angular momentum, e.g. just set of d-orbitals on Ti atoms.</li>
</ul>

</div>
</div>
</div></section></section><section><section>
    <div class="cell border-box-sizing text_cell rendered">
      <div class="prompt input_prompt">
      </div>
      <div class="inner_cell" style='background:rgba(255,235,204,0.99)'>
	<div class="text_cell_render border-box-sizing rendered_html">
	  <h1 id="Thanks">Thanks<a class="anchor-link" href="#Thanks">&#182;</a></h1><ul>
	    <li>Sanliang Ling, University of Nottingham (these slides are basically his reformatted)</li>
	    <li>CP2K developers</li>
	  </ul>
	  <hr>
	  <p>Exercises <a href="https://www.cp2k.org/exercises:2017_uzh_cp2k-tutorial:hybrid">here</a></p>

	</div>
      </div>
</div></section></section>
</div>
</div>

<script>

  require(
  {
  // it makes sense to wait a little bit when you are loading
  // reveal from a cdn in a slow connection environment
  waitSeconds: 15
  },
  [
  "../../revealjs//lib/js/head.min.js",
  "../../revealjs//js/reveal.js"
  ],

  function(head, Reveal){

  // Full list of configuration options available here: https://github.com/hakimel/reveal.js#configuration
  Reveal.initialize({
  controls: true,
  progress: true,
  history: true,
  width: "100%",
  height: "100%",
  margin: 0.1,
  minScale: 1,
  maxScale: 1,

  // Parallax background image
  parallaxBackgroundImage: 'https://upload.wikimedia.org/wikipedia/commons/thumb/2/28/Bloch_function.svg/1280px-Bloch_function.svg.png',
  //Parallax background size
  parallaxBackgroundSize: '1280px 557px', // CSS syntax, e.g. "2100px 900px

  theme: Reveal.getQueryHash().theme, // available themes are in /css/theme
  transition: Reveal.getQueryHash().transition || 'none', // default/cube/page/concave/zoom/linear/none

  // Optional libraries used to extend on reveal.js
  dependencies: [
  { src: "../../revealjs//lib/js/classList.js",
  condition: function() { return !document.body.classList; } },
  { src: "../../revealjs//plugin/notes/notes.js",
  async: true,
  condition: function() { return !!document.body.classList; } }
  ]
  });

  var update = function(event){
  if(MathJax.Hub.getAllJax(Reveal.getCurrentSlide())){
  MathJax.Hub.Rerender(Reveal.getCurrentSlide());
  }
  };

  Reveal.addEventListener('slidechanged', update);

  var update_scroll = function(event){
  $(".reveal").scrollTop(0);
  };

  Reveal.addEventListener('slidechanged', update_scroll);

  }
  );
</script>

</body>


</html>
